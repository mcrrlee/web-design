<!--A Design by W3layouts 
Author: W3layout
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE html>
<html>
<head>
<title>Big shope A Ecommerce Category Flat Bootstarp Resposive Website Template | Register :: w3layouts</title>
<link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
<!--theme-style-->
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />	
<!--//theme-style-->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!--fonts-->
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
<!--//fonts-->
<script src="js/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

  <link href="css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
<!--theme-style-->
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />	
<!--//theme-style-->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<!--fonts-->
<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
<!--//fonts-->
<script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
<script src="js/jquery.min.js"></script>
<!--script-->

</head>
<body> 
	
	<div class="wrapper">

		<nav>

			  <div class="menu-icon">
				  <img src="images/list.png" style="z-index: 60000;  width: 3%; height: 3%;" a/></i>
			  </div>

			  <div class="logo">
				  <a href="index.html">
				  <img src="images/logo.png"  alt=" " /></a></li>
			  </div>

			  <a href="add.html" > </a>

			  <div class="search">
				  <input type="text" value="" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = '';}" >
				  <button type="submit" class="btn-3"> <img src="images/search.png" class="img_S">
				  
				  </button>

				  <div  class="swap btn-3">
				  
					  <a href="add.html" >swap </a>
						  
				  
				  </div>

				  <div  class="Chat">
				  
					  <a href="chat.html" ><img src="images/chat.png" > </a>
						  
				  
				  </div>

				  <div  class="profile_">
				  
					  <a href="profile.html" ><img src="images/user.png" > </a>
						  
				  
				  </div>

				  
	  
			  
			  </div>

			  

				  
			  <ul >
				  

				  <!-- <li ><a href="profile.html"  class="btn">  </a> </li> -->
				   <li><a href="profile.html"  id="user_para" class="btn">  </a> </li> 

				  <li > <a  href="login.html" id="login" class="btn"> LOGIN </a></li>

				  <li > <a href="register.html"  id="signup" class="btn"> SIGNUP </a></li>
 
				  <li ><a id="logout" style="display: none;" onclick="logout()" class="btn">Logout</a></li>         
			  </ul>

		  </div>
  </nav>



	<!---->
	<div class="container" style="position: relative; padding-top: 5%;"> 
			         
		<div class="register" >
		  	  <div> 
				 <div class="  register-top-grid">
					<h2 class="text-center">เพิ่มสินค้าแลกเปลี่ยน</h2>
					<div class="aaa">
						<span>ชื่อสินค้า<label>*</label></span>
						<input id="nameitem" type="text"> 
					

					<div class="container p-y-1">
  
   <div class="row m-b-1">
    <div class="col-sm-6 offset-sm-3">
      <div class="form-group inputDnD">
        <label class="sr-only" for="inputFile">File Upload</label>
        <input type="file" class="form-control-file text-success font-weight-bold" id="imglist"  accept="image/*" multiple onchange="readUrl(this)" data-title="Drag and drop a file">
      </div>
    </div>
  </div>
   
  
</div>						<span>รายละเอียด<label>*</label></span>
						<input id="Detail" type="text"> 

						
						
					</div>
					 
				     
				</div>
				<div class=""> </div>
				<div class="register-but text-center">
				   <div>
					   <button  onclick="additemtrading()" >submit</button>
					   <div class=""> </div>
				   </div>
				</div>
		   </div>
		        
	</div><br>
	<!---->


	<script>
		$(document).ready(function() {
	   $(".menu-icon").on("click", function() {
			 $("nav ul").toggleClass("showing");
	   });
 });

 $(window).on("scroll", function() {
	   if($(window).scrollTop()) {
			 $('nav').addClass('color');
	   }

	   else {
			 $('nav').removeClass('color');
	   }
 })
 firebase.auth().onAuthStateChanged(function (user) {
				if (user) {
					// User is signed in.
					var user = firebase.auth().currentUser;

					if (user != null) {
						//console.log(1);
						var email_id = user.email;
						var ref = firebase.database().ref("userlist/" + email_id.replaceAll(/\./, ''));
						ref.on("value", (snapshot) => {
							if (snapshot.exists()) {
								console.log("userlist/" + email_id.replaceAll(/\./, ''));
								var data = snapshot.val();
								console.log(user.email);
								console.log(data.username);
								document.getElementById("login").style.display = "none";
								document.getElementById("signup").style.display = "none";
								document.getElementById("user_para").style.display = "block";
								document.getElementById("logout").style.display = "block";
								document.getElementById("user_para").innerHTML = data.username;

							}
							else {
								console.log("No data available");
							}
						});
					}

				} else {
					// No user is signed in.
					window.location.href = 'login.html';

				}
			});
			function logout() {
				firebase.auth().signOut();
			}
			function additemtrading() {
				var datauser = '';
				var user = firebase.auth().currentUser;
				data = firebase.database();
				var ref = firebase.database().ref("userlist/" + user.email.replaceAll(/\./, ''));
				ref.on("value", (snapshot) => {if (snapshot.exists()) { datauser = snapshot.val(); 
					console.log('load DB');
					console.log(datauser.username+datauser.runid);
				}
				else{
					console.log('fail load DB');
				}});
				

				var nameitem = document.getElementById("nameitem").value;
				var Detail = document.getElementById("Detail").value;
				//var wantlist = document.getElementById("wantlist").value;
				var imglist = document.getElementById("imglist");
				//var storageRef = firebase.storage().child("img");
				data.ref("ItemTrading/"+user.email.replaceAll(/\./, '')+"/"+nameitem.replaceAll(/\./, '')+datauser.runid).set({
					owrname:datauser.username,
					runid: datauser.runid,
					nameitem:nameitem,
					//wantlist:wantlist,
					Detail:Detail

				});
				data.ref('userlist/'+user.email.replaceAll(/\./, '')+"/runid").set(datauser.runid+1);

				for (i = 0; i <= imglist.files.length; i++)	{
					var storageRef = firebase.storage().ref("ItemTrading/"+user.email.replaceAll(/\./, '')+"/"+nameitem.replaceAll(/\./, '')+(datauser.runid-1)+"/"+i)
					storageRef.put(imglist.files[i]).then((snapshot) => { console.log(i+'Uploaded a blob or file!');});
				}
				;
				
				

			}
			$('#contactForm').submit(function () {
 sendContactForm();
 return false;
});
//list item trading
</script>

<script type="text/javascript">
	function readUrl(input) {
  
  if (input.files && input.files[0]) {
    let reader = new FileReader();
    reader.onload = (e) => {
      let imgData = e.target.result;
      let imgName = input.files[0].name;
      input.setAttribute("data-title", imgName);
      console.log(e.target.result);
    }
    reader.readAsDataURL(input.files[0]);
  }

}
</script>
</body>
</html>